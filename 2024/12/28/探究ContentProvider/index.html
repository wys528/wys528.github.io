<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>探究ContentProvider | Hexo</title><meta name="author" content="lele"><meta name="copyright" content="lele"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ContentProvider简介ContentProvider主要用于在不同的应用程序之间实现数据共享的功能，它提供了一套完整的 机制，允许一个程序访问另一个程序中的数据，同时还能保证被访问数据的安全性。目前，使 用ContentProvider是Android实现跨程序共享数据的标准方式。 运行时权限Android权限机制详解首先回顾一下过去Android的权限机制。我们在第6章写Broadc">
<meta property="og:type" content="article">
<meta property="og:title" content="探究ContentProvider">
<meta property="og:url" content="http://example.com/2024/12/28/%E6%8E%A2%E7%A9%B6ContentProvider/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="ContentProvider简介ContentProvider主要用于在不同的应用程序之间实现数据共享的功能，它提供了一套完整的 机制，允许一个程序访问另一个程序中的数据，同时还能保证被访问数据的安全性。目前，使 用ContentProvider是Android实现跨程序共享数据的标准方式。 运行时权限Android权限机制详解首先回顾一下过去Android的权限机制。我们在第6章写Broadc">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg">
<meta property="article:published_time" content="2024-12-28T01:27:10.000Z">
<meta property="article:modified_time" content="2024-12-29T09:52:17.126Z">
<meta property="article:author" content="lele">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" href="/image/tx.jpg"><link rel="canonical" href="http://example.com/2024/12/28/%E6%8E%A2%E7%A9%B6ContentProvider/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '探究ContentProvider',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-12-29 17:52:17'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/image/tx.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">87</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Hexo"><img class="site-icon" src="/image/test.gif"/><span class="site-name">Hexo</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">探究ContentProvider</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-12-28T01:27:10.000Z" title="发表于 2024-12-28 09:27:10">2024-12-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-12-29T09:52:17.126Z" title="更新于 2024-12-29 17:52:17">2024-12-29</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="探究ContentProvider"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="ContentProvider"><a href="#ContentProvider" class="headerlink" title="ContentProvider"></a>ContentProvider</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>ContentProvider主要用于在不同的应用程序之间实现数据共享的功能，它提供了一套完整的 机制，允许一个程序访问另一个程序中的数据，同时还能保证被访问数据的安全性。目前，使 用ContentProvider是Android实现跨程序共享数据的标准方式。</p>
<h2 id="运行时权限"><a href="#运行时权限" class="headerlink" title="运行时权限"></a>运行时权限</h2><h3 id="Android权限机制详解"><a href="#Android权限机制详解" class="headerlink" title="Android权限机制详解"></a>Android权限机制详解</h3><p>首先回顾一下过去Android的权限机制。我们在第6章写BroadcastTest项目的时候第一次接触 了Android权限相关的内容，当时为了要监听开机广播，我们在AndroidManifest.xml文件中 添加了这样一句权限声明：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://shemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">packate</span>=<span class="string">&quot;com.example.broadcasttest&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot;</span>/&gt;</span></span><br><span class="line">    、、、</span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>因为监听开机广播涉及了用户设备的安全，因此必须在AndroidManifest.xml中加入权限声 明，否则我们的程序就会崩溃。</p>
<h3 id="在程序运行时申请权限"><a href="#在程序运行时申请权限" class="headerlink" title="在程序运行时申请权限"></a>在程序运行时申请权限</h3><p>首先新建一个RuntimePermissionTest项目，我们就在这个项目的基础上学习运行时权限的使 用方法。我们就使用CALL_PHONE这个权限来作为本小节的示例吧。</p>
<p>接下来修改AndroidManifest.xml文件，在其中声明如下权限：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">manifest</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-feature</span> <span class="attr">android:name</span>=<span class="string">&quot;android.hardware.telephony&quot;</span> <span class="attr">android:required</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.CALL_PHONE&quot;</span>/&gt;</span></span><br><span class="line">    、、、</span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改MainActivity中的代码如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span>:<span class="type">AppCompatActivity</span>()&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding:ActivityMainBinding</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState:<span class="type">Bundle</span>?)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstance)</span><br><span class="line">        binding = ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line">        <span class="keyword">val</span> makeCall = binding.makeCall</span><br><span class="line">        makeCall.setOnClickListener&#123;</span><br><span class="line">            <span class="comment">//检查权限</span></span><br><span class="line">            <span class="keyword">if</span>(ContextCompat.checkSelfPermission(<span class="keyword">this</span>,Manifest.permission.CALL_PHONE)!=PackageManager.PERMISSIONO_GRANTED)&#123;</span><br><span class="line">                <span class="comment">//请求权限</span></span><br><span class="line">                ActivityCompat.requestPermissin(<span class="keyword">this</span>,arrayOf(Manifest.permission.CALL_PHONE),<span class="number">1</span>)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//拨打电话</span></span><br><span class="line">                call()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onRequestPermissionResult</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        	requestCode: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">            permissions: <span class="type">Array</span>&lt;<span class="type">out</span> <span class="type">String</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">            grantResults: <span class="type">IntArray</span></span></span></span><br><span class="line"><span class="params"><span class="function">        )</span></span>&#123;</span><br><span class="line">            <span class="keyword">super</span>.onRequsetPermissionResult(requestCode,permissions,grantResults)</span><br><span class="line">            <span class="keyword">when</span>(requestCode)&#123;</span><br><span class="line">                <span class="number">1</span>-&gt;&#123;</span><br><span class="line">                    <span class="keyword">if</span>(grantResults.isNotEmpty()&amp;&amp;grantRsults[<span class="number">0</span>]==PackageManager.PERMISSION_GRANTED)&#123;</span><br><span class="line">                        call()</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        Toast.makeText(<span class="keyword">this</span>,<span class="string">&quot;Your denied the permission&quot;</span>,Toast.LENGTH_SHORT).show()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">call</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="keyword">val</span> intent = Intent(Intent.ACTION_CALL)</span><br><span class="line">                intent.<span class="keyword">data</span> = Uri.parse(<span class="string">&quot;tel:13905020820&quot;</span>)</span><br><span class="line">                startActivity(intent)</span><br><span class="line">            &#125;<span class="keyword">catch</span>(e:SecurityException)&#123;</span><br><span class="line">                e.printStackTrace()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="访问其他程序中的数据"><a href="#访问其他程序中的数据" class="headerlink" title="访问其他程序中的数据"></a>访问其他程序中的数据</h2><h3 id="ContentResolver的基本用法"><a href="#ContentResolver的基本用法" class="headerlink" title="ContentResolver的基本用法"></a>ContentResolver的基本用法</h3><p>如果想访问ContentProvider中共享的数据，就一定要借助ContentResolver类，可以通过Context中的getContentResolver()方法获取该类的实例。</p>
<p>内容Uri</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">content:<span class="comment">//com.example.app.provider/table1 </span></span><br><span class="line">content:<span class="comment">//com.example.app.provider/table2</span></span><br></pre></td></tr></table></figure>

<p>在得到了内容URI字符串之后，我们还需要将它解析成Uri对象才可以作为参数传入。解析的方 法也相当简单，代码如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> uri = Uri.parse(<span class="string">&quot;content://com.example.app/provider/table1&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>只需要调用Uri.parse()方法，就可以将内容URI字符串解析成Uri对象了。</p>
<p>现在我们就可以使用这个Uri对象查询table1表中的数据了，代码如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> cursor = contentResolver.query(</span><br><span class="line">	uri,</span><br><span class="line">    projection,</span><br><span class="line">    selection,</span><br><span class="line">    selectionArgs,</span><br><span class="line">    sortOrder)</span><br></pre></td></tr></table></figure>

<p>查询完成后返回的仍然是一个Cursor对象，这时我们就可以将数据从Cursor对象中逐个读取 出来了。读取的思路仍然是通过移动游标的位置遍历Cursor的所有行，然后取出每一行中相应 列的数据，代码如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(cursor.moveToNext())&#123;</span><br><span class="line">    <span class="keyword">val</span> column1 = cursor.getString(cursor.getColumnIndex(<span class="string">&quot;column1&quot;</span>))</span><br><span class="line">    <span class="keyword">val</span> column2 = cursor.getString(cursor.getColumnIndex(<span class="string">&quot;column2&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line">cursor.close()</span><br></pre></td></tr></table></figure>

<p>掌握了最难的查询操作，剩下的增加、修改、删除操作就更不在话下了。我们先来看看如何向 table1表中添加一条数据，代码如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> values = contentValuesOf(<span class="string">&quot;column1&quot;</span> to <span class="string">&quot;text&quot;</span>,<span class="string">&quot;column2&quot;</span> to <span class="number">1</span>)</span><br><span class="line">contentResolver.insert(uri,values)</span><br></pre></td></tr></table></figure>

<p>可以看到，仍然是将待添加的数据组装到ContentValues中，然后调用ContentResolver的 insert()方法，将Uri和ContentValues作为参数传入即可</p>
<p>如果我们想要更新这条新添加的数据，把column1的值清空，可以借助ContentResolver的 update()方法实现，代码如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> valuse = contentValuesOf(<span class="string">&quot;column1&quot;</span> to <span class="string">&quot;&quot;</span>)</span><br><span class="line">contentResolver.update(uri.values,<span class="string">&quot;column1 = ? and column2 = ?&quot;</span>,arrayOf(<span class="string">&quot;text&quot;</span>,<span class="string">&quot;1&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>注意，上述代码使用了selection和selectionArgs参数来对想要更新的数据进行约束，以 防止所有的行都会受影响</p>
<p>最后，可以调用ContentResolver的delete()方法将这条数据删除掉，代码如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">contentResolver.delete(uri,<span class="string">&quot;column2 = ?&quot;</span>, arrayOf(<span class="string">&quot;1&quot;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="读取系统联系人"><a href="#读取系统联系人" class="headerlink" title="读取系统联系人"></a>读取系统联系人</h3><p>新建一个ContactsTest项目，让我们开始动手吧</p>
<p>首先还是来编写一下布局文件，这里我们希望读取出来的联系人信息能够在ListView中显示， 因此，修改activity_main.xml中的代码，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> </span></span><br><span class="line"><span class="tag">     <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span> </span></span><br><span class="line"><span class="tag">     <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span> </span></span><br><span class="line"><span class="tag">     <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> &gt;</span> </span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">ListView</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">android:id</span>=<span class="string">&quot;@+id/contactsView&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> &gt;</span> </span><br><span class="line">     <span class="tag">&lt;/<span class="name">ListView</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p>接着修改MainActivity中的代码，如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span>:<span class="type">AppCompatActivity</span>()&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> contactsList = ArrayList&lt;String&gt;()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> adapter = ArrayAdapter&lt;String&gt;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding :ActivityMainBinding</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState:<span class="type">Bundle</span>?)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        binding = ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line">        adapter = ArrayAdapter(<span class="keyword">this</span>,android.R.layout.simple_1,contactsList)</span><br><span class="line">        <span class="keyword">val</span> contactsView = binding.contactsView</span><br><span class="line">        <span class="keyword">if</span>(ContextCompat.checkSelfPermission(<span class="keyword">this</span>,Manifest.permission.READ_CONTACTS)!=PackageManager.PERMISSION_GRANTED)&#123;</span><br><span class="line">            ActivityCompat.requestPermission(<span class="keyword">this</span>,arrayOf(Manifest.permission.READ_CONTACTS),<span class="number">1</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            readContacts()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onRequestPermissionResult</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        requsetCode:<span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        permissions:<span class="type">Array</span>&lt;<span class="type">out</span> <span class="type">String</span>&gt;</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">grantResults</span>:<span class="type">IntArray</span></span></span></span><br><span class="line"><span class="params"><span class="function">    )</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onReausetPermissionResult(requestCode,permissions,grantResults)</span><br><span class="line">        <span class="keyword">when</span>(requestCode)&#123;</span><br><span class="line">            <span class="number">1</span>-&gt;&#123;</span><br><span class="line">                <span class="keyword">if</span>(grantResults.isNotEmpty()&amp;&amp;grantResults[<span class="number">0</span>]==PackageManager.PERMISSION_GRSANTED)&#123;</span><br><span class="line">                    readContacts()</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    Toast.makeText(<span class="keyword">this</span>,<span class="string">&quot;You denied the permission&quot;</span>,Toast.LENGTH_SHORT).show()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@SuppressLint(<span class="string">&quot;Range&quot;</span>)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">readContacts</span><span class="params">()</span></span>&#123;</span><br><span class="line">        contentResolver.query(ContactsContract.CommonDataKinds.Phone.CONTENT_URI,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>)?.apply&#123;</span><br><span class="line">            <span class="keyword">while</span>(moveToNext())&#123;</span><br><span class="line">                <span class="comment">//获取联系人姓名</span></span><br><span class="line">                <span class="keyword">val</span> displayName = getString(getColumnIndex(ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME))</span><br><span class="line">                <span class="comment">//获取联系人手机号</span></span><br><span class="line">                <span class="keyword">val</span> number = getString(getColumnIndex(ContactsContract.CommonDataKinds.Phone.NUMBER))</span><br><span class="line">                contactsList.add(<span class="string">&quot;<span class="variable">$displayName</span>\n<span class="variable">$number</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        adapter.notifyDataSetChanged()</span><br><span class="line">        close()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="创建自己的ContentProvider"><a href="#创建自己的ContentProvider" class="headerlink" title="创建自己的ContentProvider"></a>创建自己的ContentProvider</h2><h3 id="创建ContentProvider的步骤"><a href="#创建ContentProvider的步骤" class="headerlink" title="创建ContentProvider的步骤"></a>创建ContentProvider的步骤</h3><p>ContentProvider类中有6个抽象方法，我们在使用子类继承 它的时候，需要将这6个方法全部重写。观察下面的代码示例：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyProvider</span> : <span class="type">ContentProvider</span>()&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span>:<span class="built_in">Boolean</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">query</span><span class="params">(uri:<span class="type">Uri</span>,projection:<span class="type">Array</span>&lt;<span class="type">String</span>&gt;?,selection:<span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">                      selectionArgs:<span class="type">Array</span>&lt;<span class="type">String</span>&gt;?,sortOrder:<span class="type">String</span>?)</span></span>:Cursor?&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">insert</span><span class="params">(uri:<span class="type">Uri</span>, valuse:<span class="type">ContentValues</span>?,selection:<span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">                       selectionArgs:<span class="type">Array</span>&lt;<span class="type">String</span>&gt;?)</span></span>:<span class="built_in">Int</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">update</span><span class="params">(uri:<span class="type">Uri</span>,values:<span class="type">ContentValues</span>?,selection:<span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">                       selectionArgs:<span class="type">Array</span>&lt;<span class="type">String</span>&gt;?)</span></span>:<span class="built_in">Int</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">delete</span><span class="params">(uri:<span class="type">Uri</span>,secection:<span class="type">String</span>?,selectionArgs:<span class="type">Array</span>&lt;<span class="type">String</span>&gt;?)</span></span>:<span class="built_in">Int</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getType</span><span class="params">(uri:<span class="type">Uri</span>)</span></span>:String?&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>onCreate()。初始化ContentProvider的时候调用。通常会在这里完成对数据库的创建和升级等操作，返回true表示ContentProvider的初始化成功，返回false则表示失败。</li>
<li>query()。从ContentProvider中查询数据。uri参数用于确定查询哪张表，projection用于确定查询哪些列，selection和selectionArgs参数用于约定查询哪些行，sortOrder参数用于对结果进行排序，查询的结果存放在Cursor对象中返回。</li>
<li>insert()。向ContentProvider中添加一条数据。uri参数用于确定要添加到的表，代待添加的数据保存在values参数中。添加完成后，返回一个用于表示这条新记录的URI</li>
<li>update()。更新ContentProvider中已有的数据。uri参数用于确定更新哪一张表中的数据，新数据保存在values参数中，selection和selectionArgs参数用于约束更新哪些行，受影响的行数将作为返回值返回。</li>
<li>delete()。从ContentProvider中删除数据。uri参数用于确定删除哪一张表中的数据，selection和selectionArgs参数用于约束删除哪些行，被删除的行数将作为返回值返回。</li>
<li>getType()。根据传入的内容URI返回相应的MIME类型</li>
</ul>
<p>一个标准的内容URI写法是：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">content://com.example.app.provider/table1</span><br></pre></td></tr></table></figure>

<p>这就表示调用方期望访问的是com.example.app这个应用的table1表中的数据。</p>
<p>除此之外，我们还可以在这个内容URI的后面加上一个id，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">content://com.example.app.provier/table1/1</span><br></pre></td></tr></table></figure>

<p>这就表示调用方期望访问的是com.example.app这个应用的table1表中id为1的数据。</p>
<p>内容URI的格式主要就只有以上两种，以路径结尾表示期望访问该表中所有的数据，以id结尾表 示期望访问该表中拥有相应id的数据。我们可以使用通配符分别匹配这两种格式的内容URI，规 则如下。</p>
<ul>
<li>*表示匹配任意长度的任意字符</li>
<li>#表示匹配任意长度的数字</li>
</ul>
<p>所以，一个能够匹配任意表的内容RUI格式就可以写成：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">content://com.example/app.provider/*</span><br></pre></td></tr></table></figure>

<p>一个能够匹配table1表中任意一行数据的内容URI格式就可以写成:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">comtent://com.example.app.provider/table1/#</span><br></pre></td></tr></table></figure>

<p>接着，我们再借助UriMatcher这个类就可以轻松地实现匹配内容URI的功能。UriMatcher中 提供了一个addURI()方法，这个方法接收3个参数，可以分别把authority、path和一个自 定义代码传进去。这样，当调用UriMatcher的match()方法时，就可以将一个Uri对象传入，返回值是某个能够匹配这个Uri对象所对应的自定义代码，利用这个代码，我们就可以判断 出调用方期望访问的是哪张表中的数据了。修改MyProvider中的代码，如下所示:</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyProvider</span> : <span class="type">ContentProvider</span>()&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> table1Dir = <span class="number">0</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> table1Item = <span class="number">1</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> table2Dir = <span class="number">2</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> table2Item = <span class="number">3</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> uriMatcher = UriMatcher(UriMatcher.NO_MATCH)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>&#123;</span><br><span class="line">        uriMatcher.addURI(<span class="string">&quot;com.example.app.privoider&quot;</span>,<span class="string">&quot;table1&quot;</span>,table1Dir)</span><br><span class="line">        uriMatcher.addURI(<span class="string">&quot;com.example.app.provider&quot;</span>,<span class="string">&quot;table1/#&quot;</span>,table1Item)</span><br><span class="line">        uriMatcher.addURI(<span class="string">&quot;com.example.app.provider&quot;</span>,<span class="string">&quot;table2&quot;</span>,table2Dir)</span><br><span class="line">        uriMathcer.addURI(<span class="string">&quot;com.example.app.provider&quot;</span>,<span class="string">&quot;table2/#&quot;</span>,table2Item)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">query</span><span class="params">(ur:<span class="type">Ur</span>,projection:<span class="type">Array</span>&lt;<span class="type">String</span>&gt;,selection:<span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">                      selectionArgs:<span class="type">Array</span>&lt;<span class="type">String</span>&gt;?,sortOrder:<span class="type">String</span>?)</span></span>:Cursor?&#123;</span><br><span class="line">        <span class="keyword">when</span>(uriMatcher.match(uri))&#123;</span><br><span class="line">            table1Dir-&gt;&#123;</span><br><span class="line">                <span class="comment">//查询table1表中的所有数据</span></span><br><span class="line">            &#125;</span><br><span class="line">            table1Item-&gt;&#123;</span><br><span class="line">                <span class="comment">//查询table1表中的单条数据</span></span><br><span class="line">            &#125;</span><br><span class="line">            table2Dir-&gt;&#123;</span><br><span class="line">                <span class="comment">//查询table2表中的所有数据</span></span><br><span class="line">            &#125;</span><br><span class="line">            table2Item-&gt;&#123;</span><br><span class="line">                <span class="comment">//查询table2表中的单挑数据</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>getType方法()。所有ContentProvider都必须提供的一个方法，用于获取Uri对象的MIME类型。一个内容URI所对应的MIME字符串主要由3部分组成，Android对这3个部分做了如下格式规定。</p>
<ul>
<li>必须以vnd开头</li>
<li>如果内容URI以路径结尾，则后接android.cursor.dir&#x2F;；如果内容URI以id结尾，则后接android.cursor.item&#x2F;</li>
<li>最后接上vnd.<authority>.<path></li>
</ul>
<p>所以，对于content:&#x2F;&#x2F;com.example.app.provider&#x2F;table1这个内容URI，它所对应的MIME类型就可以写成：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vnd.android.cursor.dir/vnd.com.example.app.provider.table1</span><br></pre></td></tr></table></figure>

<p>对于content:&#x2F;&#x2F;com.example.app.provider&#x2F;table1&#x2F;1这个内容URI，它所对应的MIME类型就可以写成：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vnd.android.cursor.item/vnd.com.example.app.privider.table</span><br></pre></td></tr></table></figure>

<p>现在我们可以继续完善MyProvider中的内容了，这次来实现getType()方法中的逻辑，代码 如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyProvider</span> : <span class="type">ContentProvider</span>()&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getType</span><span class="params">(uri:<span class="type">Uri</span>)</span></span> = <span class="keyword">when</span>(uriMathcer.match(uri))&#123;</span><br><span class="line">        table1Dir -&gt; <span class="string">&quot;vnd.android.cursor.dir/vnd.com.example.app.provider.table1&quot;</span></span><br><span class="line">        table1Item -&gt; <span class="string">&quot;vnd.android.cursor.item/vnd.com.example.app.provider.table&quot;</span></span><br><span class="line">        table2Dir -&gt; <span class="string">&quot;vnd.android.cursor.dir/vnd.com.example.app.provider.table2&quot;</span></span><br><span class="line">        table2Item -&gt; <span class="string">&quot;vnd.android.cursor.item/vnd.com.example.app.provider.table2&quot;</span></span><br><span class="line">        <span class="keyword">else</span> -&gt; <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到这里，一个完整的ContentProvider就创建完成了，现在任何一个应用程序都可以使用 ContentResolver访问我们程序中的数据。那么，如何才能保证隐私数据不会泄漏出去呢？其 实多亏了ContentProvider的良好机制，这个问题在不知不觉中已经被解决了。因为所有的增 删改查操作都一定要匹配到相应的内容URI格式才能进行，而我们当然不可能向UriMatcher中 添加隐私数据的URI，所以这部分数据根本无法被外部程序访问，安全问题也就不存在了。</p>
<h3 id="实现跨程序数据共享"><a href="#实现跨程序数据共享" class="headerlink" title="实现跨程序数据共享"></a>实现跨程序数据共享</h3><p>简单起见，我们还是在上一章中DatabaseTest项目的基础上继续开发，通过ContentProvider 来给它加入外部访问接口。打开DatabaseTest项目，首先将MyDatabaseHelper中使用Toast 弹出创建数据库成功的提示去除，因为跨程序访问时我们不能直接使用Toast。然后创建一个 ContentProvider，右击com.example.databasetest包→New→Other→Content Provider</p>
<p>接着我们修改DatabaseProvider中的代码，如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DatabaseProvider</span> : <span class="type">ContentProvider</span>()&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> bookDir = <span class="number">0</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> bookItem = <span class="number">1</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> categoryDir = <span class="number">2</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> categoryItem = <span class="number">3</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> authority = <span class="string">&quot;com.example.databasttest.provider&quot;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> dbHelper : MyDatabaseHelper? = <span class="literal">null</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> uriMatcher <span class="keyword">by</span> lazy&#123;</span><br><span class="line">        <span class="keyword">val</span> matcher = UriMatcher(UriMatcher.NO_MATCH)</span><br><span class="line">        matcher.addURI(authority,<span class="string">&quot;book&quot;</span>,bookDir)</span><br><span class="line">        matcher.addURI(authority,<span class="string">&quot;book/#&quot;</span>,bookItem)</span><br><span class="line">        matcher.addURI(authority,<span class="string">&quot;category&quot;</span>,categoryDir)</span><br><span class="line">        matcher.addURI(authority,<span class="string">&quot;category/#&quot;</span>,categoryItem)</span><br><span class="line">        matcher</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> = context?.let&#123;</span><br><span class="line">        dbHelper = MyDatabaseHelper(it,<span class="string">&quot;BookStore.db&quot;</span>,<span class="number">2</span>)</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;?:<span class="literal">false</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">query</span><span class="params">(uri:<span class="type">Uri</span>,projection:<span class="type">Array</span>&lt;<span class="type">String</span>&gt;?,selection:<span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">                      selectionArgs:<span class="type">Array</span>&lt;<span class="type">String</span>&gt;?,sortOrder:<span class="type">String</span>?)</span></span> = dbHelper?.let&#123;</span><br><span class="line">        <span class="comment">//查询数据</span></span><br><span class="line">        <span class="keyword">val</span> db = it.readableDatabase</span><br><span class="line">        <span class="keyword">val</span> cursor = <span class="keyword">when</span>(uriMatcher.match(uri))&#123;</span><br><span class="line">            bookDir-&gt;db.query(<span class="string">&quot;Book&quot;</span>,projection,selection,selectionArgs,</span><br><span class="line">                             <span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,sortOrder)</span><br><span class="line">            bookItem-&gt;&#123;</span><br><span class="line">                <span class="keyword">val</span> bookId = uri.pathSegments[<span class="number">1</span>]</span><br><span class="line">                db.query(<span class="string">&quot;Book&quot;</span>,projection,<span class="string">&quot;id = ?&quot;</span>,arrayOf(bookId),<span class="literal">null</span>,<span class="literal">null</span>,</span><br><span class="line">                        sortOrder)</span><br><span class="line">            &#125;</span><br><span class="line">            categoryDir-&gt;db.query(<span class="string">&quot;Category&quot;</span>,projection,selection,selectionArgs,</span><br><span class="line">                                 <span class="literal">null</span>,<span class="literal">null</span>,sortOrder)</span><br><span class="line">            categoryItem-&gt;&#123;</span><br><span class="line">                <span class="keyword">val</span> categoryId = uri.pathSegments[<span class="number">1</span>]</span><br><span class="line">                db.query(<span class="string">&quot;Category&quot;</span>,projection,<span class="string">&quot;id = ?&quot;</span>,arrayOf(categoryId),</span><br><span class="line">                        <span class="literal">null</span>,<span class="literal">null</span>,sortOrder)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> -&gt; <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">        cursor</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> insert(uri:Uri,valuse:ContentValues?) = dbHelper?.let&#123;</span><br><span class="line">        <span class="comment">//添加数据</span></span><br><span class="line">        <span class="keyword">val</span> db = it.writableDatabase</span><br><span class="line">        <span class="keyword">val</span> uriReturn = <span class="keyword">when</span>(uriMatcher.match(uri))&#123;</span><br><span class="line">            bookDir,bookItem -&gt; &#123;</span><br><span class="line">                <span class="keyword">val</span> newBookId = db.insert(<span class="string">&quot;Book&quot;</span>,<span class="literal">null</span>,values)</span><br><span class="line">                Uri.parse(<span class="string">&quot;content://<span class="variable">$authority</span>/<span class="variable">$newBookId</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            category,categoryItem-&gt;&#123;</span><br><span class="line">                <span class="keyword">val</span> newCategoryId = db.insert(<span class="string">&quot;Category&quot;</span>,<span class="literal">null</span>,values)</span><br><span class="line">                Uri.parse(<span class="string">&quot;content://#authority/<span class="variable">$newCategoryId</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>-&gt;<span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">        UriReturn</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">update</span><span class="params">(uri:<span class="type">Uri</span>,values:<span class="type">ContentValuse</span>?,selection:<span class="type">String</span>?,</span></span></span><br><span class="line"><span class="params"><span class="function">                       selectionArgs:<span class="type">Array</span>&lt;<span class="type">String</span>&gt;?)</span></span> = dbHelper?.let&#123;</span><br><span class="line">        <span class="comment">//更新数据</span></span><br><span class="line">        <span class="keyword">val</span> db = it.writableDatbase</span><br><span class="line">        <span class="keyword">val</span> updatedRows = <span class="keyword">when</span>(uriMatcher.match(uri))&#123;</span><br><span class="line">            bookDir-&gt;db.update(<span class="string">&quot;Book&quot;</span>,values,selection,selectionArgs)</span><br><span class="line">            bookItem-&gt;&#123;</span><br><span class="line">                <span class="keyword">val</span> bookId = uri.pathSegments[<span class="number">1</span>]</span><br><span class="line">                db.update(<span class="string">&quot;Book&quot;</span>,values,id=<span class="string">&quot;?&quot;</span>,arrayOf(bookId))</span><br><span class="line">            &#125;</span><br><span class="line">            categoryDir-&gt;db.update(<span class="string">&quot;Category&quot;</span>,values,selection,selectionArgs)</span><br><span class="line">            categoryItem-&gt;&#123;</span><br><span class="line">                <span class="keyword">val</span> categoryId = uri.pathSegments[<span class="number">1</span>]</span><br><span class="line">                dp.update(<span class="string">&quot;Category&quot;</span>,valuse,id=<span class="string">&quot;?&quot;</span>,arrayOf(categoryId))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> -&gt; <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        updateRows</span><br><span class="line">    &#125;?:<span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">delete</span><span class="params">(uri:<span class="type">Uri</span>,selection:<span class="type">String</span>?,selectionArgs:<span class="type">Array</span>&lt;<span class="type">String</span>&gt;?)</span></span> = dbHelper.let&#123;</span><br><span class="line">        <span class="comment">//删除数据</span></span><br><span class="line">        <span class="keyword">val</span> db = it.writableDatabase</span><br><span class="line">        <span class="keyword">val</span> deleteRows = <span class="keyword">when</span>(uriMatcher.match(uri))&#123;</span><br><span class="line">            bookDir -&gt; db.delete(<span class="string">&quot;Book&quot;</span>,selection,selectionArgs)</span><br><span class="line">            bookItem -&gt; &#123;</span><br><span class="line">                <span class="keyword">val</span> bookId = uri.pathSegments[<span class="number">1</span>]</span><br><span class="line">                db.delete(<span class="string">&quot;Book&quot;</span>,<span class="string">&quot;id = ?&quot;</span>,arrayOf(bookId))</span><br><span class="line">            &#125;</span><br><span class="line">            categoryDir-&gt;db.delete(<span class="string">&quot;Category&quot;</span>,selection,selectionArgs)</span><br><span class="line">            categoryItem-&gt;&#123;</span><br><span class="line">                <span class="keyword">val</span> categoryId = uri.pathSegments[<span class="number">1</span>]</span><br><span class="line">                db.delete(<span class="string">&quot;Category&quot;</span>,<span class="string">&quot;id = ?&quot;</span>,arrayOf(categoryId))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> -&gt; <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        deletedRows</span><br><span class="line">    &#125;?:<span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getType</span><span class="params">(uri: <span class="type">Uri</span>)</span></span>=<span class="keyword">when</span>(uriMatcher.match(uri))&#123;</span><br><span class="line">        bookDir-&gt;<span class="string">&quot;vnd.android.cursor.dir/vnd.com.example.databasetest.provider.book&quot;</span></span><br><span class="line">        bookItem-&gt;<span class="string">&quot;vnd.android.cursor.item/vnd.com.example.databasetest.provider.book&quot;</span></span><br><span class="line">        categoryDir-&gt;<span class="string">&quot;vnd.android.cursor.dir/vnd.com.example.databesttest.provider.category&quot;</span></span><br><span class="line">        categoryItem-&gt;<span class="string">&quot;vnd.android.cursor.item/vnd.com.example.databesttest.provider.category&quot;</span></span><br><span class="line">        <span class="keyword">else</span>-&gt;<span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码虽然很长，不过不用担心，这些内容都不难理解，因为使用的全部都是上一小节中我们学 到的知识。首先，在类的一开始，同样是定义了4个变量，分别用于表示访问Book表中的所有 数据、访问Book表中的单条数据、访问Category表中的所有数据和访问Category表中的单条 数据。然后在一个by lazy代码块里对UriMatcher进行了初始化操作，将期望匹配的几种 URI格式添加了进去。by lazy代码块是Kotlin提供的一种懒加载技术，代码块中的代码一开始 并不会执行，只有当uriMatcher变量首次被调用的时候才会执行，并且会将代码块中最后一 行代码的返回值赋给uriMatcher。</p>
<p>接下来就是每个抽象方法的具体实现了，先来看一下onCreate()方法。这个方法的代码很 短，但是语法可能有点特殊。这里我们综合利用了Getter方法语法糖、?.操作符、let函 数、?:操作符以及单行代码函数语法糖。首先调用了getContext()方法并借助?.操作符和 let函数判断它的返回值是否为空：如果为空就使用?:操作符返回false，表示 ContentProvider初始化失败；如果不为空就执行let函数中的代码。在let函数中创建了一个 MyDatabaseHelper的实例，然后返回true表示ContentProvider初始化成功。由于我们借 助了多个操作符和标准函数，因此这段逻辑是在一行表达式内完成的，符合单行代码函数的语 法糖要求，所以直接用等号连接返回值即可。其他几个方法的语法结构是类似的，相信你应该 能看得明白。</p>
<p>接着看一下query()方法，在这个方法中先获取了SQLiteDatabase的实例，然后根据传入的 Uri参数判断用户想要访问哪张表，再调用SQLiteDatabase的query()进行查询，并将 Cursor对象返回就好了。注意，当访问单条数据的时候，调用了Uri对象的 getPathSegments()方法，它会将内容URI权限之后的部分以“&#x2F;”符号进行分割，并把分割后 的结果放入一个字符串列表中，那这个列表的第0个位置存放的就是路径，第1个位置存放的就 是id了。得到了id之后，再通过selection和     selectionArgs参数进行约束，就实现了查询 单条数据的功能。</p>
<p>再往后就是insert()方法，它也是先获取了SQLiteDatabase的实例，然后根据传入的Uri参 数判断用户想要往哪张表里添加数据，再调用SQLiteDatabase的insert()方法进行添加就可 以了。注意，insert()方法要求返回一个能够表示这条新增数据的URI，所以我们还需要调用 Uri.parse()方法，将一个内容URI解析成Uri对象，当然这个内容URI是以新增数据的id结尾 的。</p>
<p>接下来就是update()方法了，相信这个方法中的代码已经完全难不倒你了，也是先获取 SQLiteDatabase的实例，然后根据传入的uri参数判断用户想要更新哪张表里的数据，再调用 SQLiteDatabase的update()方法进行更新就好了，受影响的行数将作为返回值返回</p>
<p>下面是delete()方法，是不是感觉越到后面越轻松了？因为你已经渐入佳境，真正找到窍门 了。这里仍然是先获取SQLiteDatabase的实例，然后根据传入的uri参数判断用户想要删除哪 张表里的数据，再调用SQLiteDatabase的delete()方法进行删除就好了，被删除的行数将作 为返回值返回</p>
<p>最后是getType()方法，这个方法中的代码完全是按照上一节中介绍的格式规则编写的，相信 已经没有解释的必要了。这样我们就将ContentProvider中的代码全部编写完了。</p>
<p>另外，还有一点需要注意，ContentProvider一定要在AndroidManifest.xml文件中注册才可 以使用。不过幸运的是，我们是使用Android Studio的快捷方式创建的ContentProvider，因 此注册这一步已经自动完成了。</p>
<p>现在DatabaseTest这个项目就已经拥有了跨程序共享数据的功能了，我们赶快来尝试一下。首 先需要将DatabaseTest程序从模拟器中删除，以防止上一章中产生的遗留数据对我们造成干 扰。然后运行一下项目，将DatabaseTest程序重新安装在模拟器上。接着关闭DatabaseTest 这个项目，并创建一个新项目ProviderTest，我们将通过这个程序去访问DatabaseTest中的数 据。</p>
<p>还是先来编写一下布局文件吧，修改activity_main.xml中的代码，如下所示</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">&quot;vertical&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/addData&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Add To Book&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/queryData&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Query From Book&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/updateData&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Update Book&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/deleteData&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Delete From Book&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>布局文件很简单，里面放置了4个按钮，分别用于添加、查询、更新和删除数据。然后修改 MainActivity中的代码，如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.providertest</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.<span class="keyword">annotation</span>.SuppressLint</span><br><span class="line"><span class="keyword">import</span> android.net.Uri</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"><span class="keyword">import</span> androidx.activity.enableEdgeToEdge</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity</span><br><span class="line"><span class="keyword">import</span> androidx.core.content.contentValuesOf</span><br><span class="line"><span class="keyword">import</span> androidx.core.view.ViewCompat</span><br><span class="line"><span class="keyword">import</span> androidx.core.view.WindowInsetsCompat</span><br><span class="line"><span class="keyword">import</span> com.example.providertest.databinding.ActivityMainBinding</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> bookId : String? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressLint(<span class="string">&quot;Range&quot;</span>)</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        <span class="keyword">val</span> binding = ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line">        <span class="keyword">val</span> addData = binding.addData</span><br><span class="line">        addData.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> uri = Uri.parse(<span class="string">&quot;content://com.example.databasetest.provider/book&quot;</span>)</span><br><span class="line">            <span class="keyword">val</span> values = contentValuesOf(<span class="string">&quot;name&quot;</span> to <span class="string">&quot;A Clash of Kings&quot;</span>,</span><br><span class="line">                <span class="string">&quot;author&quot;</span> to <span class="string">&quot;George Martin&quot;</span>,<span class="string">&quot;pages&quot;</span> to <span class="number">1040</span>, <span class="string">&quot;price&quot;</span> to <span class="number">22.85</span>)</span><br><span class="line">            <span class="keyword">val</span> newUri = contentResolver.insert(uri,values)</span><br><span class="line">            bookId = newUri?.pathSegments?.<span class="keyword">get</span>(<span class="number">1</span>)</span><br><span class="line">            Log.d(<span class="string">&quot;MainActivity&quot;</span>,<span class="string">&quot;InsertedURI:<span class="variable">$newUri</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> queryData = binding.queryData</span><br><span class="line">        queryData.setOnClickListener &#123;</span><br><span class="line">            <span class="keyword">val</span> uri = Uri.parse(<span class="string">&quot;content://com.example.databasetest.provider/book&quot;</span>)</span><br><span class="line">            <span class="keyword">val</span> cursor = contentResolver.query(uri, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">if</span> (cursor != <span class="literal">null</span> &amp;&amp; cursor.moveToFirst()) &#123;</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    <span class="keyword">val</span> name = cursor.getString(cursor.getColumnIndex(<span class="string">&quot;name&quot;</span>))</span><br><span class="line">                    <span class="keyword">val</span> author = cursor.getString(cursor.getColumnIndex(<span class="string">&quot;author&quot;</span>))</span><br><span class="line">                    <span class="keyword">val</span> pages = cursor.getInt(cursor.getColumnIndex(<span class="string">&quot;pages&quot;</span>))</span><br><span class="line">                    <span class="keyword">val</span> price = cursor.getDouble(cursor.getColumnIndex(<span class="string">&quot;price&quot;</span>))</span><br><span class="line">                    Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;book name is <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">                    Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;book author is <span class="variable">$author</span>&quot;</span>)</span><br><span class="line">                    Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;book pages is <span class="variable">$pages</span>&quot;</span>)</span><br><span class="line">                    Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;book price is <span class="variable">$price</span>&quot;</span>)</span><br><span class="line">                &#125; <span class="keyword">while</span> (cursor.moveToNext())</span><br><span class="line">                cursor.close()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Log.d(<span class="string">&quot;MainActivity&quot;</span>, <span class="string">&quot;No data found.&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> updateData = binding.updateData</span><br><span class="line">        updateData.setOnClickListener &#123;</span><br><span class="line">            bookId?.let &#123;</span><br><span class="line">                <span class="keyword">val</span> uri = Uri.parse(<span class="string">&quot;content://com.example.databasetest.provider/book/<span class="variable">$it</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">val</span> values = contentValuesOf(<span class="string">&quot;name&quot;</span> to <span class="string">&quot;A Storm of Swords&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;pages&quot;</span> to <span class="number">1216</span>, <span class="string">&quot;price&quot;</span> to <span class="number">24.05</span>)</span><br><span class="line">                contentResolver.update(uri, values, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> deleteData = binding.deleteData</span><br><span class="line">        deleteData.setOnClickListener &#123;</span><br><span class="line">            bookId?.let &#123;</span><br><span class="line">                <span class="keyword">val</span> uri = Uri.parse(<span class="string">&quot;content://com.example.databasetest.provider/book/<span class="variable">$it</span>&quot;</span>)</span><br><span class="line">                contentResolver.delete(uri, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，我们分别在这4个按钮的点击事件里面处理了增删改查的逻辑。添加数据的时候，首 先调用了Uri.parse()方法将一个内容URI解析成Uri对象，然后把要添加的数据都存放到 ContentValues对象中，接着调用ContentResolver的insert()方法执行添加操作就可以 了。注意，insert()方法会返回一个Uri对象，这个对象中包含了新增数据的id，我们通过 getPathSegments()方法将这个id取出，稍后会用到它。 查询数据的时候，同样是调用了Uri.parse()方法将一个内容URI解析成Uri对象，然后调用 ContentResolver的query()方法查询数据，查询的结果当然还是存放在Cursor对象中。之 后对Cursor进行遍历，从中取出查询结果，并一一打印出来。 更新数据的时候，也是先将内容URI解析成Uri对象，然后把想要更新的数据存放到 ContentValues对象中，再调用ContentResolver的update()方法执行更新操作就可以 了。注意，这里我们为了不想让Book表中的其他行受到影响，在调用Uri.parse()方法时， 给内容URI的尾部增加了一个id，而这个id正是添加数据时所返回的。这就表示我们只希望更新 刚刚添加的那条数据，Book表中的其他行都不会受影响。 删除数据的时候，也是使用同样的方法解析了一个以id结尾的内容URI，然后调用 ContentResolver的delete()方法执行删除操作就可以了。由于我们在内容URI里指定了一 个id，因此只会删掉拥有相应id的那行数据，Book表中的其他数据都不会受影响。</p>
<h2 id="Kotlin课堂：泛型和委托"><a href="#Kotlin课堂：泛型和委托" class="headerlink" title="Kotlin课堂：泛型和委托"></a>Kotlin课堂：泛型和委托</h2><h3 id="泛型的基本用法"><a href="#泛型的基本用法" class="headerlink" title="泛型的基本用法"></a>泛型的基本用法</h3><p>首先解释一下什么是泛型。在一般的编程模式下，我们需要给任何一个变量指定一个具体的类 型，而泛型允许我们在不指定具体类型的情况下进行编程，这样编写出来的代码将会拥有更好 的扩展性。</p>
<p>举个例子，List是一个可以存放数据的列表，但是List并没有限制我们只能存放整型数据或字符 串数据，因为它没有指定一个具体的类型，而是使用泛型来实现的。也正是如此，我们才可以 使用List、List之类的语法来构建具体类型的列表。</p>
<p>那么要怎样才能定义自己的泛型实现呢？这里我们来学习一下基本的语法。</p>
<p>泛型主要有两种定义方式：一种是定义泛型类，另一种是定义泛型方法，使用的语法结构都是 。当然括号内的T并不是固定要求的，事实上你使用任何英文字母或单词都可以，但是通常 情况下，T是一种约定俗成的泛型写法。</p>
<p>如果我们要定义一个泛型类，就可以这么写</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>&lt;<span class="type">T</span>&gt; &#123; </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">fun</span> <span class="title">method</span><span class="params">(param: <span class="type">T</span>)</span></span>: T &#123; </span><br><span class="line">         <span class="keyword">return</span> param </span><br><span class="line">     &#125; </span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时的MyClass就是一个泛型类，MyClass中的方法允许使用T类型的参数和返回值。</p>
<p>我们在调用MyClass类和method()方法的时候，就可以将泛型指定成具体的类型，如下所 示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> myClass = MyClass&lt;<span class="built_in">Int</span>&gt;() </span><br><span class="line"><span class="keyword">val</span> result = myClass.method(<span class="number">123</span>)</span><br></pre></td></tr></table></figure>

<p>这里我们将MyClass类的泛型指定成Int类型，于是method()方法就可以接收一个Int类型的 参数，并且它的返回值也变成了Int类型。</p>
<p>而如果我们不想定义一个泛型类，只是想定义一个泛型方法，应该要怎么写呢？也很简单，只 需要将定义泛型的语法结构写在方法上面就可以了，如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123; </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">method</span><span class="params">(param: <span class="type">T</span>)</span></span>: T &#123; </span><br><span class="line">         <span class="keyword">return</span> param </span><br><span class="line">     &#125; </span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时的调用方式也需要进行相应的调整</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> myClass = MyClass() </span><br><span class="line"><span class="keyword">val</span> result = myClass.method&lt;<span class="built_in">Int</span>&gt;(<span class="number">123</span>)</span><br></pre></td></tr></table></figure>

<p>可以看到，现在是在调用method()方法的时候指定泛型类型了。另外，Kotlin还拥有非常出色 的类型推导机制，例如我们传入了一个Int类型的参数，它能够自动推导出泛型的类型就是Int 型，因此这里也可以直接省略泛型的指定：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> myClass = MyClass() </span><br><span class="line"><span class="keyword">val</span> result = myClass.method(<span class="number">123</span>)</span><br></pre></td></tr></table></figure>

<p>Kotlin还允许我们对泛型的类型进行限制。目前你可以将method()方法的泛型指定成任意类 型，但是如果这并不是你想要的话，还可以通过指定上界的方式来对泛型的类型进行约束，比 如这里将method()方法的泛型上界设置为Number类型，如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123; </span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : Number&gt;</span> <span class="title">method</span><span class="params">(param: <span class="type">T</span>)</span></span>: T &#123; </span><br><span class="line">         <span class="keyword">return</span> param </span><br><span class="line">     &#125; </span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另外，在默认情况下，所有的泛型都是可以指定成可空类型的，这是因为在不手动指定上界的 时候，泛型的上界默认是Any?。而如果想要让泛型的类型不可为空，只需要将泛型的上界手动 指定成Any就可以了</p>
<p>接下来，我们尝试对本小节所学的泛型知识进行应用。回想一下，在6.5.1小节学习高阶函数的 时候，我们编写了一个build函数，代码如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> StringBuilder.<span class="title">build</span><span class="params">(block: <span class="type">StringBuilder</span>.() -&gt; <span class="type">Unit</span>)</span></span>: StringBuilder &#123; </span><br><span class="line">     block() </span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">this</span> </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>这个函数的作用和apply函数基本是一样的，只是build函数只能作用在StringBuilder类上 面，而apply函数是可以作用在所有类上面的。现在我们就通过本小节所学的泛型知识对build函数进行扩展，让它实现和apply函数完全一样的功能。</p>
<p>思考一下，其实并不复杂，只需要使用将build函数定义成泛型函数，再将原来所有强制指 定StringBuilder的地方都替换成T就可以了。新建一个build.kt文件，并编写如下代码：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">build</span><span class="params">(block: <span class="type">T</span>.() -&gt; <span class="type">Unit</span>)</span></span>: T &#123; </span><br><span class="line">     block() </span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">this</span> </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>大功告成！现在你完全可以像使用apply函数一样去使用build函数了，比如说这里我们使用 build函数简化Cursor的遍历：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">contentResolver.query(uri, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>)?.build &#123; </span><br><span class="line">     <span class="keyword">while</span> (moveToNext()) &#123; </span><br><span class="line">         ... </span><br><span class="line">     &#125; </span><br><span class="line">     close() </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="类委托和委托属性"><a href="#类委托和委托属性" class="headerlink" title="类委托和委托属性"></a>类委托和委托属性</h3><p>委托是一种设计模式，它的基本理念是：操作对象自己不会去处理某段逻辑，而是会把工作委 托给另外一个辅助对象去处理。</p>
<p>Kotlin中也是支持委托功能的，并且将委托功能分为了两种：类委托和委托属性。下面我们逐个 进行学习。</p>
<p>首先来看类委托，它的核心思想在于将一个类的具体实现委托给另一个类去完成。在前面的章 节中，我们曾经使用过Set这种数据结构，它和List有点类似，只是它所存储的数据是无序 的，并且不能存储重复的数据。Set是一个接口，如果要使用它的话，需要使用它具体的实现 类，比如HashSet。而借助于委托模式，我们可以轻松实现一个自己的实现类。比如这里定义 一个MySet，并让它实现Set接口，代码如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MySet</span>&lt;<span class="type">T</span>&gt;(<span class="keyword">val</span> helperSet: HashSet&lt;T&gt;) : Set&lt;T&gt; &#123; </span><br><span class="line"> </span><br><span class="line">     <span class="keyword">override</span> <span class="keyword">val</span> size: <span class="built_in">Int</span> </span><br><span class="line">     <span class="keyword">get</span>() = helperSet.size </span><br><span class="line"></span><br><span class="line">     <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">contains</span><span class="params">(element: <span class="type">T</span>)</span></span> = helperSet.contains(element) </span><br><span class="line"></span><br><span class="line">     <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">containsAll</span><span class="params">(elements: <span class="type">Collection</span>&lt;<span class="type">T</span>&gt;)</span></span> = helperSet.containsAll(elements) </span><br><span class="line"></span><br><span class="line">     <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">isEmpty</span><span class="params">()</span></span> = helperSet.isEmpty() </span><br><span class="line"></span><br><span class="line">     <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">iterator</span><span class="params">()</span></span> = helperSet.iterator() </span><br><span class="line"> </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>可以看到，MySet的构造函数中接收了一个HashSet参数，这就相当于一个辅助对象。然后在 Set接口所有的方法实现中，我们都没有进行自己的实现，而是调用了辅助对象中相应的方法实 现，这其实就是一种委托模式</p>
<p>那么，这种写法的好处是什么呢？既然都是调用辅助对象的方法实现，那还不如直接使用辅助 对象得了。这么说确实没错，但如果我们只是让大部分的方法实现调用辅助对象中的方法，少 部分的方法实现由自己来重写，甚至加入一些自己独有的方法，那么MySet就会成为一个全新 的数据结构类，这就是委托模式的意义所在</p>
<p>但是这种写法也有一定的弊端，如果接口中的待实现方法比较少还好，要是有几十甚至上百个 方法的话，每个都去这样调用辅助对象中的相应方法实现，那可真是要写哭了。那么这个问题 有没有什么解决方案呢？在Java中确实没有，但是在Kotlin中可以通过类委托的功能来解决。</p>
<p>Kotlin中委托使用的关键字是by，我们只需要在接口声明的后面使用by关键字，再接上受委托 的辅助对象，就可以免去之前所写的一大堆模板式的代码了，如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MySet</span>&lt;<span class="type">T</span>&gt;(<span class="keyword">val</span> helperSet: HashSet&lt;T&gt;) : Set&lt;T&gt; <span class="keyword">by</span> helperSet &#123; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>这两段代码实现的效果是一模一样的，但是借助了类委托的功能之后，代码明显简化了太多。 另外，如果我们要对某个方法进行重新实现，只需要单独重写那一个方法就可以了，其他的方 法仍然可以享受类委托所带来的便利，如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MySet</span>&lt;<span class="type">T</span>&gt;(<span class="keyword">val</span> helperSet: HashSet&lt;T&gt;) : Set&lt;T&gt; <span class="keyword">by</span> helperSet &#123; </span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">fun</span> <span class="title">helloWorld</span><span class="params">()</span></span> = println(<span class="string">&quot;Hello World&quot;</span>) </span><br><span class="line"> </span><br><span class="line"> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">isEmpty</span><span class="params">()</span></span> = <span class="literal">false</span> </span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>类委托的核心思想是将一个类的具体实现委托给另一个类去完成，而委托属性的核心思想是将 一个属性（字段）的具体实现委托给另一个类去完成。</p>
<p>我们看一下委托属性的语法结构，如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123; </span><br><span class="line">     <span class="keyword">var</span> p <span class="keyword">by</span> Delegate() </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，这里使用by关键字连接了左边的p属性和右边的Delegate实例，这是什么意思呢？ 这种写法就代表着将p属性的具体实现委托给了Delegate类去完成。当调用p属性的时候会自 动调用Delegate类的getValue()方法，当给p属性赋值的时候会自动调用Delegate类的 setValue()方法。</p>
<p>因此，我们还得对Delegate类进行具体的实现才行，代码如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Delegate</span> &#123; </span><br><span class="line"> </span><br><span class="line">     <span class="keyword">var</span> propValue: Any? = <span class="literal">null</span> </span><br><span class="line"></span><br><span class="line">     <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(myClass: <span class="type">MyClass</span>, prop: <span class="type">KProperty</span>&lt;*&gt;)</span></span>: Any? &#123; </span><br><span class="line">         <span class="keyword">return</span> propValue </span><br><span class="line">     &#125; </span><br><span class="line"></span><br><span class="line">     <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(myClass: <span class="type">MyClass</span>, prop: <span class="type">KProperty</span>&lt;*&gt;, value: <span class="type">Any</span>?)</span></span> &#123; </span><br><span class="line">         propValue = value </span><br><span class="line">     &#125; </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是一种标准的代码实现模板，在Delegate类中我们必须实现getValue()和setValue()这 两个方法，并且都要使用operator关键字进行声明。 getValue()方法要接收两个参数：第一个参数用于声明该Delegate类的委托功能可以在什么 类中使用，这里写成MyClass表示仅可在MyClass类中使用；第二个参数KProperty&lt;*&gt;是 Kotlin中的一个属性操作类，可用于获取各种属性相关的值，在当前场景下用不着，但是必须在 方法参数上进行声明。另外，&lt;*&gt;这种泛型的写法表示你不知道或者不关心泛型的具体类型，只 是为了通过语法编译而已，有点类似于Java中的写法。至于返回值可以声明成任何类型，根 据具体的实现逻辑去写就行了，上述代码只是一种示例写法。 setValue()方法也是相似的，只不过它要接收3个参数。前两个参数和getValue()方法是相 同的，最后一个参数表示具体要赋值给委托属性的值，这个参数的类型必须和getValue()方 法返回值的类型保持一致。 整个委托属性的工作流程就是这样实现的，现在当我们给MyClass的p属性赋值时，就会调用 Delegate类的setValue()方法，当获取MyClass中p属性的值时，就会调用Delegate类的 getValue()方法。是不是很好理解？ 不过，其实还存在一种情况可以不用在Delegate类中实现setValue()方法，那就是 MyClass中的p属性是使用val关键字声明的。这一点也很好理解，如果p属性是使用val关键 字声明的，那么就意味着p属性是无法在初始化之后被重新赋值的，因此也就没有必要实现 setValue()方法，只需要实现getValue()方法就可以了。</p>
<h3 id="实现一个自己的lazy函数"><a href="#实现一个自己的lazy函数" class="headerlink" title="实现一个自己的lazy函数"></a>实现一个自己的lazy函数</h3><p>那么学习了Kotlin的委托功能之后，我们就可以对by lazy的工作原理进行解密了，它的基本 语法结构如下：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> p <span class="keyword">by</span> lazy&#123;  &#125;</span><br></pre></td></tr></table></figure>

<p>现在再来看这段代码，是不是觉得更有头绪了呢？实际上，by lazy并不是连在一起的关键 字，只有by才是Kotlin中的关键字，lazy在这里只是一个高阶函数而已。在lazy函数中会创建 并返回一个Delegate对象，当我们调用p属性的时候，其实调用的是Delegate对象的 getValue()方法，然后getValue()方法中又会调用lazy函数传入的Lambda表达式，这样 表达式中的代码就可以得到执行了，并且调用p属性后得到的值就是Lambda表达式中最后一行 代码的返回值。</p>
<p>这样看来，Kotlin的懒加载技术也并没有那么神秘，掌握了它的实现原理之后，我们也可以实现 一个自己的lazy函数。</p>
<p>那么话不多说，开始动手吧。新建一个Later.kt文件，并编写如下代码</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Later</span>&lt;<span class="type">T</span>&gt;(<span class="keyword">val</span> block: () -&gt; T) &#123; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>这里我们首先定义了一个Later类，并将它指定成泛型类。Later的构造函数中接收一个函数 类型参数，这个函数类型参数不接收任何参数，并且返回值类型就是Later类指定的泛型</p>
<p>接着我们在Later类中实现getValue()方法，代码如下所示：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Later</span>&lt;<span class="type">T</span>&gt;(<span class="keyword">val</span> block: () -&gt; T) &#123; </span><br><span class="line"> </span><br><span class="line">     <span class="keyword">var</span> value: Any? = <span class="literal">null</span> </span><br><span class="line"></span><br><span class="line">     <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(any: <span class="type">Any</span>?, prop: <span class="type">KProperty</span>&lt;*&gt;)</span></span>: T &#123; </span><br><span class="line">         <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123; </span><br><span class="line">             value = block() </span><br><span class="line">         &#125; </span><br><span class="line">             <span class="keyword">return</span> value <span class="keyword">as</span> T </span><br><span class="line">     &#125; </span><br><span class="line"> </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>由于懒加载技术是不会对属性进行赋值的，因此这里我们就不用实现setValue()方法了。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">lele</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/12/28/%E6%8E%A2%E7%A9%B6ContentProvider/">http://example.com/2024/12/28/%E6%8E%A2%E7%A9%B6ContentProvider/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Hexo</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/01/05/%E8%BF%90%E7%94%A8%E6%89%8B%E6%9C%BA%E5%A4%9A%E5%AA%92%E4%BD%93/" title="运用手机多媒体"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">运用手机多媒体</div></div></a></div><div class="next-post pull-right"><a href="/2024/12/26/%E6%8C%81%E4%B9%85%E5%8C%96%E6%8A%80%E6%9C%AF/" title="持久化技术"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">持久化技术</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/image/tx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">lele</div><div class="author-info__description">且行且看且从容</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">87</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Wys-Blog" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1770460890@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ContentProvider"><span class="toc-number">1.</span> <span class="toc-text">ContentProvider</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E6%9D%83%E9%99%90"><span class="toc-number">1.2.</span> <span class="toc-text">运行时权限</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Android%E6%9D%83%E9%99%90%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.2.1.</span> <span class="toc-text">Android权限机制详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E6%97%B6%E7%94%B3%E8%AF%B7%E6%9D%83%E9%99%90"><span class="toc-number">1.2.2.</span> <span class="toc-text">在程序运行时申请权限</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%85%B6%E4%BB%96%E7%A8%8B%E5%BA%8F%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.</span> <span class="toc-text">访问其他程序中的数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ContentResolver%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">1.3.1.</span> <span class="toc-text">ContentResolver的基本用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E7%B3%BB%E7%BB%9F%E8%81%94%E7%B3%BB%E4%BA%BA"><span class="toc-number">1.3.2.</span> <span class="toc-text">读取系统联系人</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84ContentProvider"><span class="toc-number">1.4.</span> <span class="toc-text">创建自己的ContentProvider</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAContentProvider%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.4.1.</span> <span class="toc-text">创建ContentProvider的步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E8%B7%A8%E7%A8%8B%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB"><span class="toc-number">1.4.2.</span> <span class="toc-text">实现跨程序数据共享</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kotlin%E8%AF%BE%E5%A0%82%EF%BC%9A%E6%B3%9B%E5%9E%8B%E5%92%8C%E5%A7%94%E6%89%98"><span class="toc-number">1.5.</span> <span class="toc-text">Kotlin课堂：泛型和委托</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">1.5.1.</span> <span class="toc-text">泛型的基本用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%A7%94%E6%89%98%E5%92%8C%E5%A7%94%E6%89%98%E5%B1%9E%E6%80%A7"><span class="toc-number">1.5.2.</span> <span class="toc-text">类委托和委托属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84lazy%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.3.</span> <span class="toc-text">实现一个自己的lazy函数</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/02/15/SunnyWeather2%E6%98%BE%E7%A4%BA%E5%A4%A9%E6%B0%94%E4%BF%A1%E6%81%AF/" title="SunnyWeather2显示天气信息"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SunnyWeather2显示天气信息"/></a><div class="content"><a class="title" href="/2025/02/15/SunnyWeather2%E6%98%BE%E7%A4%BA%E5%A4%A9%E6%B0%94%E4%BF%A1%E6%81%AF/" title="SunnyWeather2显示天气信息">SunnyWeather2显示天气信息</a><time datetime="2025-02-15T14:46:43.000Z" title="发表于 2025-02-15 22:46:43">2025-02-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/04/Android%E9%AB%98%E7%BA%A7%E6%8A%80%E5%B7%A7/" title="Android高级技巧"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android高级技巧"/></a><div class="content"><a class="title" href="/2025/02/04/Android%E9%AB%98%E7%BA%A7%E6%8A%80%E5%B7%A7/" title="Android高级技巧">Android高级技巧</a><time datetime="2025-02-04T04:22:08.000Z" title="发表于 2025-02-04 12:22:08">2025-02-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/19/Jetpack/" title="Jetpack"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Jetpack"/></a><div class="content"><a class="title" href="/2025/01/19/Jetpack/" title="Jetpack">Jetpack</a><time datetime="2025-01-19T08:57:38.000Z" title="发表于 2025-01-19 16:57:38">2025-01-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/11/Mterial-Design/" title="Mterial Design"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mterial Design"/></a><div class="content"><a class="title" href="/2025/01/11/Mterial-Design/" title="Mterial Design">Mterial Design</a><time datetime="2025-01-11T12:31:15.000Z" title="发表于 2025-01-11 20:31:15">2025-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/10/%E5%8D%8F%E7%A8%8B/" title="协程"><img src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="协程"/></a><div class="content"><a class="title" href="/2025/01/10/%E5%8D%8F%E7%A8%8B/" title="协程">协程</a><time datetime="2025-01-10T10:01:29.000Z" title="发表于 2025-01-10 18:01:29">2025-01-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By lele</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>